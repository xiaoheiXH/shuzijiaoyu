<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•™å®¤ä¿¯è§†å›¾è®¾è®¡å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        header {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid #e1e5eb;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .coordinate-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .coord-box {
            background: #f8f9fa;
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            font-size: 14px;
        }

        .coord-box span {
            font-weight: bold;
            color: #3498db;
        }

        .main-content {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .left-panel {
            flex: 1;
            min-width: 320px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid #e1e5eb;
            display: flex;
            flex-direction: column;
            max-height: 800px;
        }

        .right-panel {
            flex: 2;
            min-width: 600px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid #e1e5eb;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .panel-title {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f1f2f6;
        }

        .elements-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
            flex: 1;
            overflow-y: auto;
            padding-right: 5px;
        }

        .element-item {
            background: #f8f9fa;
            border: 2px dashed #bdc3c7;
            border-radius: 8px;
            padding: 15px 10px;
            text-align: center;
            cursor: grab;
            transition: all 0.2s ease;
            user-select: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .element-item:hover {
            border-color: #3498db;
            background: #e3f2fd;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(52, 152, 219, 0.2);
        }

        .element-item:active {
            cursor: grabbing;
        }

        .element-icon {
            width: 40px;
            height: 40px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .element-name {
            font-size: 14px;
            font-weight: 500;
            color: #2c3e50;
        }

        .element-size {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 4px;
        }

        .element-limit {
            font-size: 11px;
            color: #e74c3c;
            margin-top: 2px;
            font-weight: 500;
        }

        .canvas-container {
            position: relative;
            width: 100%;
            height: 600px;
            background-color: #F9DA89;
            border-radius: 8px;
            overflow: auto;
            border: 2px solid #d4ac6e;
            flex: 1;
        }

        .canvas-inner {
            position: relative;
            width: 750px;
            height: 650px;
        }

        .coordinate-overlay {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 10;
        }

        .fixed-shape {
            position: absolute;
            border: 2px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        .main-room {
            background-color: #F9DA89;
            border: 3px solid #d4ac6e;
        }

        .shape-1, .shape-2, .shape-3 {
            background-color: #F9DA89;
            border: 2px solid #d4ac6e;
        }

        .square-1 {
            background-color: #E91E63;
        }

        .square-2 {
            background-color: #9C27B0;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .save-btn {
            background: #2ecc71;
            color: white;
        }

        .save-btn:hover {
            background: #27ae60;
            box-shadow: 0 4px 8px rgba(46, 204, 113, 0.3);
        }

        .reset-btn {
            background: #e74c3c;
            color: white;
        }

        .reset-btn:hover {
            background: #c0392b;
            box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);
        }

        .export-btn {
            background: #3498db;
            color: white;
        }

        .export-btn:hover {
            background: #2980b9;
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }

        .instructions {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            font-size: 14px;
            color: #555;
        }

        .instructions h3 {
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .instructions ul {
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 5px;
        }

        .element-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            font-size: 14px;
            border: 1px solid #e1e5eb;
            z-index: 100;
            min-width: 250px;
        }

        .element-info.hidden {
            display: none;
        }

        .draggable-element {
            position: absolute;
            cursor: move;
            z-index: 5;
            transition: transform 0.1s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            user-select: none;
            overflow: hidden;
            transform-origin: center;
        }

        .draggable-element:hover {
            z-index: 15;
        }

        .draggable-element.selected {
            outline: 3px dashed #3498db;
            z-index: 10;
        }

        .draggable-icon {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .draggable-label {
            font-size: 10px;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.9);
            padding: 2px 6px;
            border-radius: 4px;
            margin-top: 4px;
        }

        .coord-inputs {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .coord-inputs input {
            width: 80px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .update-btn {
            padding: 8px 12px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .update-btn:hover {
            background: #2980b9;
        }

        .delete-btn {
            padding: 8px 12px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            width: 100%;
        }

        .delete-btn:hover {
            background: #c0392b;
        }

        .element-delete-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #e74c3c;
            color: white;
            border: none;
            font-size: 12px;
            line-height: 20px;
            text-align: center;
            cursor: pointer;
            z-index: 20;
            display: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .draggable-element.selected .element-delete-btn {
            display: block;
        }

        .element-delete-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }

        .counter {
            position: absolute;
            top: -8px;
            left: -8px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
        }

        /* ç‰¹æ®Šå…ƒç´ æ ·å¼ */
        .chair {
            border-radius: 4px;
            background-color: #8BC34A;
        }

        .table-rect {
            background-color: #795548;
        }

        .whiteboard {
            background-color: #ffffff;
            border: 2px solid #90A4AE;
            border-radius: 4px;
        }

        .table-round {
            border-radius: 100%;
            background-color: #8D6E63 !important;
            border: 3px solid #5D4037 !important;
            box-shadow: 0 0 8px rgba(0,0,0,0.3) !important;
            opacity: 0.7 !important;
            z-index: 1000 !important;
        }

        .table-semi-round {
            background-color: transparent;
            position: relative;
        }

        .door-double {
            background-color: #8D6E63;
        }

        .door-single {
            background-color: #8D6E63;
        }

        .cabinet {
            background-color: #A1887F;
            background-image: 
                linear-gradient(to right, #8D6E63 1px, transparent 1px),
                linear-gradient(to bottom, #8D6E63 1px, transparent 1px);
            background-size: 15px 15px;
        }

        .cabinet-long {
            background-color: #A1887F;
            background-image: 
                linear-gradient(to right, #8D6E63 1px, transparent 1px),
                linear-gradient(to bottom, #8D6E63 1px, transparent 1px);
            background-size: 30px 15px;
        }

        .floor-socket {
            background-color: #757575;
            border-radius: 4px;
        }

        .plant {
            background-color: #DFEBB2;
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            position: relative;
        }

        .plant::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            width: 5px;
            height: 5px;
            background-color: #8BC34A;
            border-radius: 50%;
        }

        .plant::after {
            content: '';
            position: absolute;
            top: 3px;
            right: 5px;
            width: 3px;
            height: 3px;
            background-color: #8BC34A;
            border-radius: 50%;
        }

        .shape-label {
            position: absolute;
            top: 3px;
            left: 3px;
            font-size: 9px;
            color: white;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.5);
            background: rgba(0,0,0,0.3);
            padding: 1px 3px;
            border-radius: 2px;
            pointer-events: none;
        }

        /* æ—‹è½¬æ§åˆ¶ç‚¹æ ·å¼ */
        .rotate-handle {
            position: absolute;
            bottom: -20px;
            right: -20px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3498db;
            color: white;
            border: 2px solid white;
            cursor: pointer;
            z-index: 30;
            display: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .draggable-element.selected .rotate-handle {
            display: block;
        }

        .rotate-handle:hover {
            background: #2980b9;
            transform: scale(1.1);
        }

        .rotate-handle::after {
            content: 'â†»';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10px;
        }

        /* åŠåœ†æ¡Œç‰¹æ®Šæ ·å¼ - é‡æ–°è®¾è®¡ */
        .semi-table-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .semi-table-rectangle {
            position: absolute;
            width: 75px; /* 1.5m = 75px */
            height: 37.5px; /* 0.75m = 37.5px */
            background-color: #795548;
            border-radius: 4px;
            left: 0;
            top: 0;
        }

        .semi-table-semicircle {
            position: absolute;
            width: 75px; /* ç›´å¾„1.5m = 75px */
            height: 37.5px; /* åŠå¾„0.75m = 37.5px */
            background-color: #795548;
            border-radius: 0 0 75px 75px;
            left: 0;
            top: 37.5px; /* åŠåœ†åœ¨çŸ©å½¢ä¸‹æ–¹ */
            opacity: 0.5;
        }

        .semi-table-dashed-line {
            position: absolute;
            width: 100%;
            height: 2px;
            top: 37.5px;
            left: 0;
            border-top: 1px dashed white;
            z-index: 1;
        }

        /* ä¸‰è§’å½¢æ¡Œå­ç‰¹æ®Šæ ·å¼ */
        .table-sector {
            background-color: #795548;
            border: 2px solid #5D4037;
            /* ç­‰è…°ä¸‰è§’å½¢ï¼Œåº•è¾¹åœ¨ä¸‹ï¼Œé¡¶ç‚¹åœ¨ä¸Š */
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            border-radius: 0;
            position: relative;
        }

        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            
            .left-panel, .right-panel {
                min-width: 100%;
            }
            
            .canvas-container {
                height: 500px;
            }
        }

        @media (max-width: 768px) {
            .elements-container {
                grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            }
            
            .canvas-container {
                height: 400px;
            }
            
            .control-btn {
                flex: 1;
                min-width: 120px;
            }
        }

        /* ç½‘æ ¼çº¿æ ·å¼ */
        .grid-line {
            position: absolute;
            pointer-events: none;
        }

        .grid-line.x {
            width: 100%;
            height: 1px;
            background: rgba(0, 0, 0, 0.1);
            left: 0;
        }

        .grid-line.y {
            height: 100%;
            width: 1px;
            background: rgba(0, 0, 0, 0.1);
            top: 0;
        }

        /* åæ ‡è½´æ ·å¼ */
        .axis {
            position: absolute;
            pointer-events: none;
            z-index: 2;
        }

        .axis.x {
            width: 100%;
            height: 2px;
            background: #e74c3c;
            left: 0;
            top: 0;
        }

        .axis.y {
            height: 100%;
            width: 2px;
            background: #e74c3c;
            top: 0;
            left: 0;
        }

        .axis-label {
            position: absolute;
            font-size: 12px;
            color: #e74c3c;
            font-weight: bold;
            pointer-events: none;
        }

        .meter-mark {
            position: absolute;
            background: #3498db;
            pointer-events: none;
        }

        .meter-mark.x {
            width: 1px;
            height: 8px;
            top: -4px;
        }

        .meter-mark.y {
            width: 8px;
            height: 1px;
            left: -4px;
        }

        .meter-label {
            position: absolute;
            font-size: 9px;
            color: #3498db;
            pointer-events: none;
        }

        /* ç»Ÿè®¡ä¿¡æ¯æ ·å¼ */
        .stats-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid #e1e5eb;
        }

        .stats-title {
            font-size: 16px;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            background: white;
            border-radius: 4px;
            border: 1px solid #dee2e6;
        }

        .stat-name {
            font-size: 13px;
            color: #495057;
        }

        .stat-value {
            font-size: 13px;
            font-weight: 600;
            color: #2c3e50;
        }

        /* æ—‹è½¬æ§åˆ¶è¾“å…¥æ¡† */
        .rotation-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            align-items: center;
        }

        .rotation-controls input {
            width: 80px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .rotation-value {
            font-size: 14px;
            min-width: 40px;
            text-align: center;
        }

        /* å…ƒç´ é€æ˜åº¦ */
        .draggable-element {
            opacity: 0.7;
        }

        .fixed-shape {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>æ•™å®¤ä¿¯è§†å›¾è®¾è®¡å™¨</h1>
            <p class="subtitle">æ‹–æ‹½å·¦ä¾§å…ƒç´ åˆ°å³ä¾§æ•™å®¤ä¿¯è§†å›¾ä¸­ï¼Œç‚¹å‡»å…ƒç´ å¯æŸ¥çœ‹å’Œç¼–è¾‘åæ ‡ï¼Œç‚¹å‡»åˆ é™¤æŒ‰é’®å¯ç§»é™¤å…ƒç´ </p>
            <div class="coordinate-info">
                <div class="coord-box">åæ ‡ç³»åŸç‚¹ï¼š<span>å·¦ä¸Šè§’ (0, 0)</span></div>
                <div class="coord-box">Xè½´æ–¹å‘ï¼š<span>æ°´å¹³å‘å³</span></div>
                <div class="coord-box">Yè½´æ–¹å‘ï¼š<span>å‚ç›´å‘ä¸‹</span></div>
                <div class="coord-box">æ¯”ä¾‹å°ºï¼š<span>1ç±³ = 50åƒç´ </span></div>
            </div>
        </header>
        
        <div class="main-content">
            <div class="left-panel">
                <h2 class="panel-title">æ•™å®¤å…ƒç´ åº“</h2>
                <p style="margin-bottom: 15px; color: #7f8c8d; font-size: 14px;">æ‹–æ‹½å…ƒç´ åˆ°å³ä¾§æ•™å®¤ä¸­</p>
                
                <div class="elements-container" id="elementsContainer">
                    <!-- å…ƒç´ å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="instructions">
                    <h3>ä½¿ç”¨è¯´æ˜</h3>
                    <ul>
                        <li>æ‹–æ‹½å·¦ä¾§å…ƒç´ åˆ°æ•™å®¤ä¿¯è§†å›¾ä¸­</li>
                        <li>ç‚¹å‡»æ•™å®¤ä¸­çš„å…ƒç´ å¯ä»¥é€‰ä¸­å¹¶æŸ¥çœ‹åæ ‡</li>
                        <li>ç‚¹å‡»å…ƒç´ å³ä¸Šè§’çš„Ã—æŒ‰é’®å¯ä»¥åˆ é™¤è¯¥å…ƒç´ </li>
                        <li>æ‹–æ‹½å³ä¸‹è§’çš„è“è‰²åœ†ç‚¹å¯ä»¥æ—‹è½¬å…ƒç´ </li>
                        <li>ä¿®æ”¹åæ ‡åç‚¹å‡»"æ›´æ–°ä½ç½®"æŒ‰é’®åº”ç”¨æ›´æ”¹</li>
                        <li>ç‚¹å‡»"ä¿å­˜è®¾è®¡"æŒ‰é’®ä¿å­˜å½“å‰å¸ƒå±€</li>
                        <li>å…ƒç´ æ•°é‡ä¸Šé™ï¼šæ¯ä¸ªå…ƒç´ ç±»å‹æœ‰æœ€å¤§æ”¾ç½®æ•°é‡é™åˆ¶</li>
                    </ul>
                </div>
            </div>
            
            <div class="right-panel">
                <h2 class="panel-title">æ•™å®¤ä¿¯è§†å›¾ (15m Ã— 10m)</h2>
                <div class="canvas-container" id="canvasContainer">
                    <div class="canvas-inner" id="canvasInner">
                        <!-- ç½‘æ ¼çº¿å’Œåæ ‡è½´å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        <!-- å›ºå®šå›¾å½¢ -->
                        <div class="fixed-shape main-room" id="main-room" style="width: 750px; height: 500px; left: 0px; top: 0px;">
                            <!-- ä¸»æ•™å®¤æ ‡ç­¾å·²åˆ é™¤ -->
                        </div>
                        <div class="fixed-shape shape-1" id="shape-1" style="width: 200px; height: 150px; left: 0px; top: 500px;">
                            <div class="shape-label">ä¼šè®®å®¤</div>
                        </div>
                        <div class="fixed-shape shape-2" id="shape-2" style="width: 125px; height: 175px; left: 625px; top: 325px;">
                            <div class="shape-label">èŒ¶æ°´é—´</div>
                        </div>
                        <div class="fixed-shape shape-3" id="shape-3" style="width: 100px; height: 45px; left: 325px; top: 25px;">
                            <div class="shape-label">è®²å°</div>
                        </div>
                        <div class="fixed-shape square-1" id="square-1" style="width: 22.5px; height: 22.5px; left: 212.5px; top: 325px;">
                            <div class="shape-label">æŸ±</div>
                        </div>
                        <div class="fixed-shape square-2" id="square-2" style="width: 22.5px; height: 22.5px; left: 292.5px; top: 325px;">
                            <div class="shape-label">æŸ±</div>
                        </div>
                        
                        <!-- å¯æ‹–æ‹½å…ƒç´ å®¹å™¨ -->
                        <div id="draggable-container"></div>
                    </div>
                    
                    <!-- åæ ‡ä¿¡æ¯é¢æ¿ -->
                    <div class="element-info hidden" id="element-info">
                        <div id="info-title" style="font-weight: 600; margin-bottom: 8px;">å…ƒç´ ä¿¡æ¯</div>
                        <div id="info-coords" style="margin-bottom: 5px;">åæ ‡: (0, 0)</div>
                        <div id="info-size" style="margin-bottom: 5px;">å°ºå¯¸: 0m Ã— 0m</div>
                        <div id="info-rotation" style="margin-bottom: 5px;">æ—‹è½¬: 0Â°</div>
                        <div class="coord-inputs">
                            <input type="number" id="coord-x" placeholder="Xåæ ‡(px)">
                            <input type="number" id="coord-y" placeholder="Yåæ ‡(px)">
                            <button class="update-btn" id="update-coords">æ›´æ–°ä½ç½®</button>
                        </div>
                        <div class="rotation-controls">
                            <span>æ—‹è½¬è§’åº¦:</span>
                            <input type="number" id="rotation-angle" placeholder="è§’åº¦(0-360)" min="0" max="360" step="0.1">
                            <button class="update-btn" id="update-rotation">æ›´æ–°æ—‹è½¬</button>
                            <div style="font-size: 12px; color: #7f8c8d; margin-top: 5px;">æç¤ºï¼šé€‰ä¸­å…ƒç´ åè‡ªåŠ¨èšç„¦ï¼Œç›´æ¥è¾“å…¥è§’åº¦åæŒ‰Enteræ›´æ–° | æŒ‰Ré”®å¿«é€Ÿèšç„¦</div>
                        </div>
                        <div class="size-controls" style="margin-top: 15px;">
                            <div style="margin-bottom: 8px; font-weight: 500;">å°ºå¯¸è°ƒæ•´:</div>
                            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                                <span>å®½åº¦(m):</span>
                                <input type="number" id="size-width" placeholder="å®½åº¦(ç±³)" min="0" step="0.01" style="width: 100px;">
                                <span>å®½åº¦(m):</span>
                                <input type="number" id="size-height" placeholder="å®½åº¦(ç±³)" min="0" step="0.01" style="width: 100px;">
                                <button class="update-btn" id="update-size">æ›´æ–°å°ºå¯¸</button>
                            </div>
                            <div style="font-size: 12px; color: #7f8c8d; margin-top: 5px;">æç¤ºï¼šè¾“å…¥å°ºå¯¸åæŒ‰Enteræ›´æ–° | æŒ‰Sé”®å¿«é€Ÿèšç„¦å®½åº¦è¾“å…¥æ¡†</div>
                        </div>
                        <button class="delete-btn" id="delete-element">åˆ é™¤å…ƒç´ </button>
                    </div>
                </div>
                
                <!-- ç»Ÿè®¡ä¿¡æ¯é¢æ¿ -->
                <div class="stats-panel" id="statsPanel">
                    <div class="stats-title">å…ƒç´ ç»Ÿè®¡</div>
                    <div class="stats-grid" id="statsGrid">
                        <!-- ç»Ÿè®¡ä¿¡æ¯å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="controls">
                    <button class="control-btn save-btn" id="save-design">ä¿å­˜è®¾è®¡</button>
                    <button class="control-btn reset-btn" id="reset-design">é‡ç½®è®¾è®¡</button>
                    <button class="control-btn export-btn" id="export-design">å¯¼å‡ºé…ç½®</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ•™å®¤é…ç½® - 1ç±³=50px
        const classroomConfig = {
            width: 750,     // 15ç±³ = 750px (15*50)
            height: 500,    // 10ç±³ = 500px (10*50)
            scale: 1,       // ç¼©æ”¾æ¯”ä¾‹
            origin: { x: 0, y: 0 } // åŸç‚¹ä½ç½®ï¼ˆå·¦ä¸Šè§’ï¼‰
        };

        // å›ºå®šå›¾å½¢é…ç½® - å…¨éƒ¨æŒ‰ç…§1ç±³=50pxæ¯”ä¾‹
        const fixedShapes = [
            { id: 'main-room', x: 0, y: 0, width: 750, height: 500, color: '#F9DA89', name: 'ä¸»æ•™å®¤', desc: '15m Ã— 10m' },
            { id: 'shape-1', x: 0, y: 500, width: 200, height: 150, color: '#F9DA89', name: 'å°é•¿æ–¹å½¢1', desc: '4m Ã— 3m' },
            { id: 'shape-2', x: 625, y: 325, width: 125, height: 175, color: '#F9DA89', name: 'å°é•¿æ–¹å½¢2', desc: '2.5m Ã— 3.5m' },
            { id: 'shape-3', x: 325, y: 25, width: 100, height: 45, color: '#F9DA89', name: 'è®²å°', desc: '2m Ã— 0.9m' },
            { id: 'square-1', x: 212.5, y: 325, width: 22.5, height: 22.5, color: '#E91E63', name: 'å°æ­£æ–¹å½¢1', desc: '0.45m Ã— 0.45m' },
            { id: 'square-2', x: 292.5, y: 325, width: 22.5, height: 22.5, color: '#9C27B0', name: 'å°æ­£æ–¹å½¢2', desc: '0.45m Ã— 0.45m' }
        ];

        // å¯æ‹–æ‹½å…ƒç´ å®šä¹‰ - å…¨éƒ¨æŒ‰ç…§1ç±³=50pxæ¯”ä¾‹
        const draggableElements = [
            { 
                id: 'chair', 
                name: 'æ¤…å­', 
                width: 25, // 0.5ç±³ = 25px (0.5*50)
                height: 25, 
                color: '#8BC34A', 
                icon: 'ğŸ’º',
                className: 'chair',
                maxCount: 60,
                desc: '0.5m Ã— 0.5m',
                shape: 'square'
            },
            { 
                id: 'table-rect', 
                name: 'æ–¹æ¡Œ', 
                width: 210, // 4.2ç±³ = 210px (4.2*50)
                height: 45,  // 0.9ç±³ = 45px (0.9*50)
                color: '#795548', 
                icon: 'â–­',
                className: 'table-rect',
                maxCount: 4,
                desc: '4.2m Ã— 0.9m',
                shape: 'rectangle'
            },
            { 
                id: 'table-round', 
                name: 'åœ†æ¡Œ', 
                width: 150, // ç›´å¾„3ç±³ = 150px (3*50)
                height: 150, 
                color: '#8D6E63',
                icon: 'â­•',
                className: 'table-round',
                 maxCount: 4,
                 desc: 'åŠå¾„1.5m',
                 shape: 'circle'
            },
            { 
                id: 'table-semi-round', 
                name: 'åŠåœ†æ¡Œ', 
                width: 75, // æ•´ä½“å®½åº¦1.5ç±³ = 75px (1.5*50)
                height: 75, // æ•´ä½“å®½åº¦ = é•¿æ–¹å½¢å®½åº¦(37.5px) + åŠåœ†å®½åº¦(37.5px)
                color: '#795548', 
                icon: 'â­•',
                className: 'table-semi-round',
                maxCount: 4,
                desc: 'é•¿æ–¹å½¢1.5mÃ—0.75m + åŠåœ†åŠå¾„0.75m',
                shape: 'semi-circle'
            },
            { 
                id: 'table-sector', 
                name: 'ä¸‰è§’å½¢æ¡Œå­', 
                width: 150, // è¾¹é•¿çº¦3ç±³ = 150px (3*50)
                height: 150, 
                color: '#795548', 
                icon: 'â–²',
                className: 'table-sector',
                maxCount: 4,
                desc: 'ä¸‰è§’å½¢æ¡Œå­ï¼Œè¾¹é•¿çº¦3m',
                shape: 'triangle'
            },
            { 
                id: 'whiteboard', 
                name: 'ç™½æ¿', 
                width: 75, // 1.5ç±³ = 75px (1.5*50)
                height: 50, // 1ç±³ = 50px (1*50)
                color: '#FFFFFF', 
                icon: 'ğŸ“‹',
                className: 'whiteboard',
                maxCount: 2,
                desc: '1.5m Ã— 1m',
                shape: 'board'
            },
            { 
                id: 'door-double', 
                name: 'åŒå¼€é—¨', 
                width: 125, // 2.5ç±³ = 125px (2.5*50)
                height: 10, // å®½åº¦æ”¹ä¸º10px
                color: '#8D6E63', 
                icon: 'ğŸšª',
                className: 'door-double',
                maxCount: 3,
                desc: '2.5m Ã— 0.2m',
                shape: 'door',
                special: 'ä»…å¯æ”¾ç½®äºç‰¹å®šå¢™ä¸Š'
            },
            { 
                id: 'door-single', 
                name: 'å•å¼€é—¨', 
                width: 75,  // 1.5ç±³ = 75px (1.5*50)
                height: 10, // å®½åº¦æ”¹ä¸º10px
                color: '#8D6E63', 
                icon: 'ğŸšª',
                className: 'door-single',
                maxCount: 3,
                desc: '1.5m Ã— 0.2m',
                shape: 'door',
                special: 'ä»…å¯æ”¾ç½®äºç‰¹å®šå¢™ä¸Š'
            },
            { 
                id: 'cabinet', 
                name: 'æŸœå­', 
                width: 45, // 0.9ç±³ = 45px (0.9*50)
                height: 45, 
                color: '#A1887F', 
                icon: 'ğŸ—„ï¸',
                className: 'cabinet',
                maxCount: 8,
                desc: '0.9m Ã— 0.9m',
                shape: 'cabinet'
            },
            { 
                id: 'cabinet-long', 
                name: 'é•¿æŸœå­', 
                width: 123.5, // 2.47ç±³ = 123.5px (2.47*50)
                height: 45,    // 0.9ç±³ = 45px (0.9*50)
                color: '#A1887F', 
                icon: 'ğŸ—„ï¸',
                className: 'cabinet-long',
                maxCount: 4,
                desc: '2.47m Ã— 0.9m',
                shape: 'cabinet-long'
            },
            { 
                id: 'floor-socket', 
                name: 'åœ°æ’', 
                width: 25, // 0.5ç±³ = 25px (0.5*50)
                height: 25, 
                color: '#757575', 
                icon: 'ğŸ”Œ',
                className: 'floor-socket',
                maxCount: 10,
                desc: '0.5m Ã— 0.5m',
                shape: 'socket'
            },
            { 
                id: 'plant', 
                name: 'ç»¿æ¤', 
                width: 10, // 0.2ç±³ = 10px (0.2*50)
                height: 10, 
                color: '#DFEBB2', 
                icon: 'ğŸŒ¿',
                className: 'plant',
                maxCount: 20,
                desc: '0.2m Ã— 0.2m',
                shape: 'leaf'
            }
        ];

        // å­˜å‚¨å·²æ”¾ç½®çš„å…ƒç´ 
        let placedElements = [];
        let selectedElement = null;
        let isDragging = false;
        let isRotating = false;
        let dragOffset = { x: 0, y: 0 };
        let rotateOffset = { x: 0, y: 0 };
        
        // åˆå§‹åŒ–å‡½æ•°
        function init() {
            // ç”Ÿæˆå·¦ä¾§å…ƒç´ åº“
            generateElementLibrary();
            
            // ç»˜åˆ¶ç½‘æ ¼å’Œåæ ‡è½´ï¼ˆä¸æ˜¾ç¤ºæ ‡ç­¾ï¼‰
            drawGridAndAxes();
            
            // åŠ è½½ä¿å­˜çš„è®¾è®¡
            loadSavedDesign();
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStatistics();
        }
        
        // ç”Ÿæˆå·¦ä¾§å…ƒç´ åº“
        function generateElementLibrary() {
            const container = document.getElementById('elementsContainer');
            container.innerHTML = '';
            
            draggableElements.forEach(element => {
                const elementDiv = document.createElement('div');
                elementDiv.className = 'element-item';
                elementDiv.draggable = true;
                elementDiv.dataset.id = element.id;
                elementDiv.dataset.name = element.name;
                elementDiv.dataset.width = element.width;
                elementDiv.dataset.height = element.height;
                elementDiv.dataset.color = element.color;
                elementDiv.dataset.icon = element.icon;
                elementDiv.dataset.class = element.className;
                elementDiv.dataset.max = element.maxCount;
                elementDiv.dataset.desc = element.desc;
                
                elementDiv.innerHTML = `
                    <div class="element-icon">${element.icon}</div>
                    <div class="element-name">${element.name}</div>
                    <div class="element-size">${element.desc}</div>
                    <div class="element-limit">ä¸Šé™: ${element.maxCount}</div>
                `;
                
                // æ‹–æ‹½äº‹ä»¶
                elementDiv.addEventListener('dragstart', handleDragStart);
                
                container.appendChild(elementDiv);
            });
        }
        
        // ç»˜åˆ¶ç½‘æ ¼å’Œåæ ‡è½´ï¼ˆä¸æ˜¾ç¤ºæ ‡ç­¾ï¼‰
        function drawGridAndAxes() {
            const canvasInner = document.getElementById('canvasInner');
            
            // æ¸…ç©ºç°æœ‰çš„ç½‘æ ¼å’Œåæ ‡è½´
            document.querySelectorAll('.grid-line, .axis, .axis-label, .meter-mark, .meter-label').forEach(el => {
                if (el.parentNode === canvasInner) {
                    el.remove();
                }
            });
            
            // ç»˜åˆ¶ç½‘æ ¼çº¿ (æ¯1ç±³=50px)
            const gridSize = 50; // 50px = 1ç±³
            
            // æ°´å¹³ç½‘æ ¼çº¿
            for (let y = 0; y <= classroomConfig.height; y += gridSize) {
                const line = document.createElement('div');
                line.className = 'grid-line x';
                line.style.top = y + 'px';
                canvasInner.appendChild(line);
            }
            
            // å‚ç›´ç½‘æ ¼çº¿
            for (let x = 0; x <= classroomConfig.width; x += gridSize) {
                const line = document.createElement('div');
                line.className = 'grid-line y';
                line.style.left = x + 'px';
                canvasInner.appendChild(line);
            }
            
            // ç»˜åˆ¶åæ ‡è½´ï¼ˆä½†ä¸æ˜¾ç¤ºæ ‡ç­¾ï¼‰
            const xAxis = document.createElement('div');
            xAxis.className = 'axis x';
            canvasInner.appendChild(xAxis);
            
            const yAxis = document.createElement('div');
            yAxis.className = 'axis y';
            canvasInner.appendChild(yAxis);
            
            // ç»˜åˆ¶åˆ»åº¦ (æ¯1ç±³=50px) - ä½†ä¸æ˜¾ç¤ºæ ‡ç­¾
            for (let i = 1; i <= 15; i++) {
                const x = i * 50;
                
                // Xè½´åˆ»åº¦
                const xMark = document.createElement('div');
                xMark.className = 'meter-mark x';
                xMark.style.left = x + 'px';
                canvasInner.appendChild(xMark);
            }
            
            for (let i = 1; i <= 10; i++) {
                const y = i * 50;
                
                // Yè½´åˆ»åº¦
                const yMark = document.createElement('div');
                yMark.className = 'meter-mark y';
                yMark.style.top = y + 'px';
                canvasInner.appendChild(yMark);
            }
        }
        
        // å¤„ç†æ‹–æ‹½å¼€å§‹
        function handleDragStart(e) {
            const elementId = e.target.dataset.id;
            const elementData = draggableElements.find(el => el.id === elementId);
            
            if (elementData) {
                // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ä¸Šé™
                const currentCount = placedElements.filter(el => el.type === elementId).length;
                if (currentCount >= elementData.maxCount) {
                    e.preventDefault();
                    showNotification(`å·²è¾¾åˆ°${elementData.name}çš„ä¸Šé™(${elementData.maxCount}ä¸ª)`);
                    return;
                }
                
                e.dataTransfer.setData('text/plain', JSON.stringify({
                    id: elementData.id,
                    name: elementData.name,
                    width: elementData.width,
                    height: elementData.height,
                    color: elementData.color,
                    icon: elementData.icon,
                    className: elementData.className,
                    desc: elementData.desc
                }));
            }
            
            // æ·»åŠ æ‹–æ‹½æ•ˆæœ
            e.target.classList.add('dragging');
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            const canvasContainer = document.getElementById('canvasContainer');
            const canvasInner = document.getElementById('canvasInner');
            
            // å…è®¸æ‹–æ‹½æ”¾ç½®
            canvasContainer.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'copy';
            });
            
            // å¤„ç†æ‹–æ‹½æ”¾ç½®
            canvasContainer.addEventListener('drop', (e) => {
                e.preventDefault();
                
                try {
                    const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                    
                    // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ä¸Šé™
                    const elementData = draggableElements.find(el => el.id === data.id);
                    const currentCount = placedElements.filter(el => el.type === data.id).length;
                    if (currentCount >= elementData.maxCount) {
                        showNotification(`å·²è¾¾åˆ°${elementData.name}çš„ä¸Šé™(${elementData.maxCount}ä¸ª)`);
                        return;
                    }
                    
                    // è·å–æ”¾ç½®ä½ç½®
                    const rect = canvasInner.getBoundingClientRect();
                    const scrollLeft = canvasContainer.scrollLeft;
                    const scrollTop = canvasContainer.scrollTop;
                    
                    // è®¡ç®—ç›¸å¯¹äºcanvasInnerçš„ä½ç½®
                    const x = e.clientX - rect.left + scrollLeft - data.width / 2;
                    const y = e.clientY - rect.top + scrollTop - data.height / 2;
                    
                    // åˆ›å»ºæ–°å…ƒç´ 
                    const elementId = createDraggableElement(data, x, y);
                    
                    // ä¿å­˜åˆ°å·²æ”¾ç½®å…ƒç´ åˆ—è¡¨
                    // åœ†æ¡Œå’Œæ‰‡å½¢æ¡Œå­ä½¿ç”¨é«˜ä¼˜å…ˆçº§z-indexï¼Œå…¶ä»–å…ƒç´ ä½¿ç”¨è®¡ç®—å€¼
                    const elementZIndex = (data.id === 'table-round' || data.id === 'table-sector') ? 1000 : calculateZIndex(data.width, data.height);
                    placedElements.push({
                        id: elementId,
                        type: data.id,
                        name: data.name,
                        x: x,
                        y: y,
                        width: data.width,
                        height: data.height,
                        color: data.color,
                        className: data.className,
                        desc: data.desc,
                        rotation: 0,
                        zIndex: elementZIndex
                    });
                    
                    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                    saveDesign();
                    
                    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                    updateStatistics();
                    
                    showNotification(`å·²æ·»åŠ ${data.name}`);
                    
                } catch (error) {
                    console.error('æ‹–æ”¾å¤±è´¥:', error);
                    showNotification('æ‹–æ”¾å¤±è´¥ï¼Œè¯·é‡è¯•', true);
                }
            });
            
            // ç§»é™¤æ‹–æ‹½æ ·å¼
            document.querySelectorAll('.element-item').forEach(item => {
                item.addEventListener('dragend', () => {
                    item.classList.remove('dragging');
                });
            });
            
            // ä¿å­˜è®¾è®¡æŒ‰é’®ï¼šåªåœ¨ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œæ—¢ä¿å­˜åˆ°æœ¬åœ°åˆè§¦å‘ä¸‹è½½
            document.getElementById('save-design').addEventListener('click', () => {
                saveDesign();      // ä¿å­˜åˆ° localStorageï¼ˆä¾›è‡ªåŠ¨æ¢å¤ä½¿ç”¨ï¼‰
                exportDesign();    // ä»…åœ¨æ‰‹åŠ¨ç‚¹å‡»â€œä¿å­˜è®¾è®¡â€æ—¶å¯¼å‡ºå¹¶ä¸‹è½½
            });
            
            // é‡ç½®è®¾è®¡æŒ‰é’®
            document.getElementById('reset-design').addEventListener('click', resetDesign);
            
            // å¯¼å‡ºé…ç½®æŒ‰é’®
            document.getElementById('export-design').addEventListener('click', exportDesign);
            
            // æ›´æ–°åæ ‡æŒ‰é’®
            document.getElementById('update-coords').addEventListener('click', updateElementCoords);
            
            // æ›´æ–°æ—‹è½¬æŒ‰é’®
            document.getElementById('update-rotation').addEventListener('click', updateElementRotation);
            
            // æ—‹è½¬è§’åº¦è¾“å…¥æ¡†æ”¯æŒEnteré”®ç›´æ¥æ›´æ–°ï¼Œå¹¶ç¡®ä¿å°é”®ç›˜ä¹Ÿèƒ½è¾“å…¥
            const rotationAngleInput = document.getElementById('rotation-angle');
            
            // æ”¯æŒä¸»é”®ç›˜å’Œå°é”®ç›˜çš„Enteré”®
            rotationAngleInput.addEventListener('keypress', (e) => {
                // ä¸»é”®ç›˜Enteré”®
                if (e.key === 'Enter' || e.keyCode === 13) {
                    e.preventDefault();
                    updateElementRotation();
                }
            });
            
            // æ”¯æŒå°é”®ç›˜Enteré”®ï¼ˆkeydownäº‹ä»¶ï¼Œå› ä¸ºå°é”®ç›˜Enterå¯èƒ½ä¸ä¼šè§¦å‘keypressï¼‰
            rotationAngleInput.addEventListener('keydown', (e) => {
                // å°é”®ç›˜Enteré”®ï¼ˆkeyCode 108ï¼‰
                if (e.keyCode === 108) {
                    e.preventDefault();
                    updateElementRotation();
                }
                // ä¸»é”®ç›˜Enteré”®åœ¨keypressä¸­å·²å¤„ç†ï¼Œè¿™é‡Œä¸éœ€è¦é‡å¤å¤„ç†
            });
            
            // æ”¯æŒå…¨å±€é”®ç›˜è¾“å…¥æ—‹è½¬è§’åº¦ï¼ˆå½“è¾“å…¥æ¡†æœ‰ç„¦ç‚¹æ—¶ï¼‰
            rotationAngleInput.addEventListener('input', (e) => {
                // å®æ—¶é¢„è§ˆæ—‹è½¬è§’åº¦ï¼ˆå¯é€‰ï¼Œå¦‚æœä¸æƒ³å®æ—¶æ›´æ–°å¯ä»¥åˆ é™¤è¿™éƒ¨åˆ†ï¼‰
                // è¿™é‡Œæˆ‘ä»¬åªåœ¨Enteræ—¶æ›´æ–°ï¼Œæ‰€ä»¥æ³¨é‡Šæ‰å®æ—¶æ›´æ–°
            });
            
            // æ·»åŠ å…¨å±€é”®ç›˜ç›‘å¬ï¼Œå½“é€‰ä¸­å…ƒç´ æ—¶ï¼ŒæŒ‰Ré”®èšç„¦åˆ°æ—‹è½¬è§’åº¦è¾“å…¥æ¡†ï¼ŒæŒ‰Sé”®èšç„¦åˆ°å®½åº¦è¾“å…¥æ¡†
            document.addEventListener('keydown', (e) => {
                const activeElement = document.activeElement;
                // å¦‚æœå½“å‰ç„¦ç‚¹ä¸åœ¨è¾“å…¥æ¡†ä¸­
                if (activeElement.tagName !== 'INPUT' && activeElement.tagName !== 'TEXTAREA') {
                    if (selectedElement) {
                        // å¦‚æœæŒ‰Ré”®ï¼Œèšç„¦åˆ°æ—‹è½¬è§’åº¦è¾“å…¥æ¡†
                        if (e.key === 'r' || e.key === 'R') {
                            const rotationInput = document.getElementById('rotation-angle');
                            if (rotationInput && !rotationInput.closest('.hidden')) {
                                rotationInput.focus();
                                rotationInput.select();
                                e.preventDefault();
                            }
                        }
                        // å¦‚æœæŒ‰Sé”®ï¼Œèšç„¦åˆ°å®½åº¦è¾“å…¥æ¡†
                        else if (e.key === 's' || e.key === 'S') {
                            const sizeWidth = document.getElementById('size-width');
                            if (sizeWidth && !sizeWidth.closest('.hidden')) {
                                sizeWidth.focus();
                                sizeWidth.select();
                                e.preventDefault();
                            }
                        }
                    }
                }
            });
            
            // æ›´æ–°å°ºå¯¸æŒ‰é’®
            document.getElementById('update-size').addEventListener('click', updateElementSize);
            
            // å°ºå¯¸è¾“å…¥æ¡†æ”¯æŒEnteré”®ç›´æ¥æ›´æ–°ï¼Œå¹¶ç¡®ä¿å°é”®ç›˜ä¹Ÿèƒ½è¾“å…¥
            const sizeWidthInput = document.getElementById('size-width');
            const sizeHeightInput = document.getElementById('size-height');
            
            // å®½åº¦è¾“å…¥æ¡†Enteré”®æ”¯æŒ
            sizeWidthInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' || e.keyCode === 13) {
                    e.preventDefault();
                    updateElementSize();
                }
            });
            
            sizeWidthInput.addEventListener('keydown', (e) => {
                if (e.keyCode === 108) { // å°é”®ç›˜Enter
                    e.preventDefault();
                    updateElementSize();
                }
            });
            
            // å®½åº¦è¾“å…¥æ¡†Enteré”®æ”¯æŒ
            sizeHeightInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' || e.keyCode === 13) {
                    e.preventDefault();
                    updateElementSize();
                }
            });
            
            sizeHeightInput.addEventListener('keydown', (e) => {
                if (e.keyCode === 108) { // å°é”®ç›˜Enter
                    e.preventDefault();
                    updateElementSize();
                }
            });
            
            
            // åˆ é™¤å…ƒç´ æŒ‰é’®
            document.getElementById('delete-element').addEventListener('click', deleteSelectedElement);
        }
        
        // è®¡ç®—å…ƒç´ çš„z-indexï¼ˆé¢ç§¯è¶Šå°ï¼Œz-indexè¶Šå¤§ï¼Œæ˜¾ç¤ºåœ¨ä¸Šå±‚ï¼‰
        function calculateZIndex(width, height) {
            const area = width * height;
            // ä½¿ç”¨ä¸€ä¸ªè¾ƒå¤§çš„åŸºæ•°å‡å»é¢ç§¯ï¼Œç¡®ä¿é¢ç§¯å°çš„z-indexå¤§
            return 10000 - area;
        }
        
        // åˆ›å»ºå¯æ‹–æ‹½å…ƒç´ 
        function createDraggableElement(data, x, y) {
            const draggableContainer = document.getElementById('draggable-container');
            const elementId = data.id + '-' + Date.now();
            
            const elementDiv = document.createElement('div');
            elementDiv.className = `draggable-element ${data.className}`;
            elementDiv.id = elementId;
            elementDiv.style.left = x + 'px';
            elementDiv.style.top = y + 'px';
            elementDiv.style.width = data.width + 'px';
            elementDiv.style.height = data.height + 'px';
            elementDiv.style.backgroundColor = data.color;
            elementDiv.style.zIndex = calculateZIndex(data.width, data.height);
            
            // æ ¹æ®å…ƒç´ ç±»å‹è®¾ç½®ä¸åŒçš„æ ·å¼
            if (data.id === 'table-round') {
                // åœ†æ¡Œç‰¹æ®Šå¤„ç†ï¼šæé«˜ä¼˜å…ˆçº§å’Œå¯è§æ€§
                elementDiv.style.borderRadius = '50%';
                elementDiv.style.border = '3px solid #5D4037';
                elementDiv.style.boxShadow = '0 0 8px rgba(0,0,0,0.3)';
                elementDiv.style.zIndex = '1000'; // è®¾ç½®é«˜ä¼˜å…ˆçº§ï¼Œç¡®ä¿å¯è§
                elementDiv.style.opacity = '0.7'; // ä¸å…¶ä»–å…ƒç´ é€æ˜åº¦ç»Ÿä¸€
                elementDiv.style.backgroundColor = '#8D6E63'; // ä¸å•å¼€é—¨é¢œè‰²ç»Ÿä¸€
            } else if (data.id === 'table-sector') {
                // ä¸‰è§’å½¢æ¡Œå­ç‰¹æ®Šå¤„ç†
                // ç­‰è…°ä¸‰è§’å½¢ï¼šé¡¶éƒ¨ä¸ºé¡¶ç‚¹ï¼Œåº•è¾¹åœ¨ä¸‹æ–¹
                elementDiv.style.clipPath = 'polygon(50% 0%, 0% 100%, 100% 100%)';
                elementDiv.style.borderRadius = '0';
                elementDiv.style.border = '2px solid #5D4037';
                elementDiv.style.zIndex = '1000'; // è®¾ç½®é«˜ä¼˜å…ˆçº§ï¼Œç¡®ä¿å¯è§
                elementDiv.style.opacity = '0.7'; // ä¸å…¶ä»–å…ƒç´ é€æ˜åº¦ç»Ÿä¸€
                elementDiv.style.backgroundColor = '#795548';
            } else if (data.id === 'door-double' || data.id === 'door-single') {
                elementDiv.style.border = '2px solid #5D4037';
            } else if (data.id !== 'table-semi-round' && data.id !== 'table-sector' && data.id !== 'plant') {
                elementDiv.style.border = '2px solid ' + darkenColor(data.color, 30);
            }
            
            // æ·»åŠ åºå·
            const currentCount = placedElements.filter(el => el.type === data.id).length + 1;
            const counter = document.createElement('div');
            counter.className = 'counter';
            counter.textContent = currentCount;
            elementDiv.appendChild(counter);
            
            // å¦‚æœæ˜¯åŠåœ†æ¡Œï¼Œåˆ›å»ºç‰¹æ®Šç»“æ„
            if (data.id === 'table-semi-round') {
                const container = document.createElement('div');
                container.className = 'semi-table-container';
                container.style.width = '100%';
                container.style.height = '100%';
                container.style.position = 'relative';
                
                // é•¿æ–¹å½¢éƒ¨åˆ†ï¼šå®½åº¦=å¤–å±‚å®½åº¦ï¼Œå®½åº¦=å¤–å±‚å®½åº¦çš„ä¸€åŠ
                const rectangle = document.createElement('div');
                rectangle.className = 'semi-table-rectangle';
                rectangle.style.width = data.width + 'px';
                rectangle.style.height = (data.height / 2) + 'px';
                rectangle.style.position = 'absolute';
                rectangle.style.left = '0';
                rectangle.style.top = '0';
                rectangle.style.backgroundColor = '#795548';
                rectangle.style.borderRadius = '4px';
                container.appendChild(rectangle);
                
                // åŠåœ†å½¢éƒ¨åˆ†ï¼šå®½åº¦=å¤–å±‚å®½åº¦ï¼Œå®½åº¦=å¤–å±‚å®½åº¦çš„ä¸€åŠ
                const semicircle = document.createElement('div');
                semicircle.className = 'semi-table-semicircle';
                semicircle.style.width = data.width + 'px';
                semicircle.style.height = (data.height / 2) + 'px';
                semicircle.style.position = 'absolute';
                semicircle.style.left = '0';
                semicircle.style.top = (data.height / 2) + 'px';
                semicircle.style.backgroundColor = '#795548';
                semicircle.style.borderRadius = `0 0 ${data.width}px ${data.width}px`;
                semicircle.style.opacity = '0.5';
                container.appendChild(semicircle);
                
                // è™šçº¿ (åœ¨é•¿æ–¹å½¢å’ŒåŠåœ†ç›¸äº¤å¤„)
                const dashedLine = document.createElement('div');
                dashedLine.className = 'semi-table-dashed-line';
                dashedLine.style.width = '100%';
                dashedLine.style.height = '2px';
                dashedLine.style.position = 'absolute';
                dashedLine.style.top = (data.height / 2) + 'px';
                dashedLine.style.left = '0';
                dashedLine.style.borderTop = '1px dashed white';
                dashedLine.style.zIndex = '1';
                container.appendChild(dashedLine);
                
                elementDiv.appendChild(container);
                elementDiv.style.backgroundColor = 'transparent';
                elementDiv.style.border = 'none';
            }
            
            // æ·»åŠ å›¾æ ‡å’Œæ ‡ç­¾
            const icon = document.createElement('div');
            icon.className = 'draggable-icon';
            icon.textContent = data.icon;
            elementDiv.appendChild(icon);
            
            const label = document.createElement('div');
            label.className = 'draggable-label';
            label.textContent = data.name;
            elementDiv.appendChild(label);
            
            // æ·»åŠ åˆ é™¤æŒ‰é’®
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'element-delete-btn';
            deleteBtn.title = 'åˆ é™¤å…ƒç´ ';
            deleteBtn.innerHTML = 'Ã—';
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                deleteElement(elementId);
            });
            elementDiv.appendChild(deleteBtn);
            
            // æ·»åŠ æ—‹è½¬æ§åˆ¶ç‚¹
            const rotateHandle = document.createElement('div');
            rotateHandle.className = 'rotate-handle';
            rotateHandle.title = 'æ‹–æ‹½æ—‹è½¬';
            elementDiv.appendChild(rotateHandle);
            
            // æ·»åŠ æ‹–æ‹½åŠŸèƒ½
            makeElementDraggable(elementDiv);
            
            // æ·»åŠ æ—‹è½¬åŠŸèƒ½
            makeElementRotatable(elementDiv);
            
            // æ·»åŠ ç‚¹å‡»é€‰æ‹©åŠŸèƒ½
            elementDiv.addEventListener('click', (e) => {
                e.stopPropagation();
                selectElement(elementDiv, data);
            });
            
            draggableContainer.appendChild(elementDiv);
            return elementId;
        }
        
        // ä½¿å…ƒç´ å¯æ‹–æ‹½
        function makeElementDraggable(element) {
            element.addEventListener('mousedown', startDrag);
            element.addEventListener('touchstart', startDragTouch);
            
            // é¼ æ ‡æ‹–æ‹½
            function startDrag(e) {
                // å¦‚æœç‚¹å‡»çš„æ˜¯åˆ é™¤æŒ‰é’®æˆ–æ—‹è½¬æŒ‰é’®ï¼Œåˆ™ä¸å¯åŠ¨æ‹–æ‹½
                if (e.target.classList.contains('element-delete-btn') || 
                    e.target.classList.contains('rotate-handle')) {
                    return;
                }
                
                e.preventDefault();
                e.stopPropagation();
                
                isDragging = true;
                selectedElement = element;
                
                // è®¡ç®—åç§»é‡
                const rect = element.getBoundingClientRect();
                dragOffset.x = e.clientX - rect.left;
                dragOffset.y = e.clientY - rect.top;
                
                // æ·»åŠ é€‰ä¸­æ ·å¼
                document.querySelectorAll('.draggable-element').forEach(el => {
                    el.classList.remove('selected');
                });
                element.classList.add('selected');
                
                // æ˜¾ç¤ºå…ƒç´ ä¿¡æ¯
                showElementInfo(element);
                
                // æ·»åŠ å…¨å±€é¼ æ ‡ç§»åŠ¨å’Œæ¾å¼€äº‹ä»¶
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', stopDrag);
            }
            
            // è§¦æ‘¸å±æ‹–æ‹½
            function startDragTouch(e) {
                // å¦‚æœç‚¹å‡»çš„æ˜¯åˆ é™¤æŒ‰é’®æˆ–æ—‹è½¬æŒ‰é’®ï¼Œåˆ™ä¸å¯åŠ¨æ‹–æ‹½
                if (e.target.classList.contains('element-delete-btn') || 
                    e.target.classList.contains('rotate-handle')) {
                    return;
                }
                
                e.preventDefault();
                e.stopPropagation();
                
                if (e.touches.length === 1) {
                    isDragging = true;
                    selectedElement = element;
                    
                    const touch = e.touches[0];
                    const rect = element.getBoundingClientRect();
                    dragOffset.x = touch.clientX - rect.left;
                    dragOffset.y = touch.clientY - rect.top;
                    
                    // æ·»åŠ é€‰ä¸­æ ·å¼
                    document.querySelectorAll('.draggable-element').forEach(el => {
                        el.classList.remove('selected');
                    });
                    element.classList.add('selected');
                    
                    // æ˜¾ç¤ºå…ƒç´ ä¿¡æ¯
                    showElementInfo(element);
                    
                    // æ·»åŠ å…¨å±€è§¦æ‘¸ç§»åŠ¨å’Œç»“æŸäº‹ä»¶
                    document.addEventListener('touchmove', dragTouch);
                    document.addEventListener('touchend', stopDragTouch);
                }
            }
            
            // é¼ æ ‡æ‹–æ‹½ç§»åŠ¨
            function drag(e) {
                if (!isDragging || !selectedElement) return;
                
                e.preventDefault();
                
                const canvasInner = document.getElementById('canvasInner');
                const canvasContainer = document.getElementById('canvasContainer');
                const canvasRect = canvasInner.getBoundingClientRect();
                const scrollLeft = canvasContainer.scrollLeft;
                const scrollTop = canvasContainer.scrollTop;
                
                // è®¡ç®—æ–°ä½ç½®
                let newX = e.clientX - canvasRect.left + scrollLeft - dragOffset.x;
                let newY = e.clientY - canvasRect.top + scrollTop - dragOffset.y;
                
                // é™åˆ¶åœ¨å®¹å™¨èŒƒå›´å†…
                newX = Math.max(0, Math.min(newX, classroomConfig.width - selectedElement.offsetWidth));
                newY = Math.max(0, Math.min(newY, classroomConfig.height + 150 - selectedElement.offsetHeight));
                
                // åº”ç”¨æ–°ä½ç½®
                selectedElement.style.left = newX + 'px';
                selectedElement.style.top = newY + 'px';
                
                // æ›´æ–°å…ƒç´ ä¿¡æ¯
                updateElementInfo(selectedElement, newX, newY);
            }
            
            // è§¦æ‘¸å±æ‹–æ‹½ç§»åŠ¨
            function dragTouch(e) {
                if (!isDragging || !selectedElement || e.touches.length !== 1) return;
                
                e.preventDefault();
                
                const touch = e.touches[0];
                const canvasInner = document.getElementById('canvasInner');
                const canvasContainer = document.getElementById('canvasContainer');
                const canvasRect = canvasInner.getBoundingClientRect();
                const scrollLeft = canvasContainer.scrollLeft;
                const scrollTop = canvasContainer.scrollTop;
                
                // è®¡ç®—æ–°ä½ç½®
                let newX = touch.clientX - canvasRect.left + scrollLeft - dragOffset.x;
                let newY = touch.clientY - canvasRect.top + scrollTop - dragOffset.y;
                
                // é™åˆ¶åœ¨å®¹å™¨èŒƒå›´å†…
                newX = Math.max(0, Math.min(newX, classroomConfig.width - selectedElement.offsetWidth));
                newY = Math.max(0, Math.min(newY, classroomConfig.height + 150 - selectedElement.offsetHeight));
                
                // åº”ç”¨æ–°ä½ç½®
                selectedElement.style.left = newX + 'px';
                selectedElement.style.top = newY + 'px';
                
                // æ›´æ–°å…ƒç´ ä¿¡æ¯
                updateElementInfo(selectedElement, newX, newY);
            }
            
            // åœæ­¢é¼ æ ‡æ‹–æ‹½
            function stopDrag() {
                if (isDragging && selectedElement) {
                    // æ›´æ–°å·²æ”¾ç½®å…ƒç´ çš„ä½ç½®
                    const elementId = selectedElement.id;
                    const elementIndex = placedElements.findIndex(el => el.id === elementId);
                    
                    if (elementIndex !== -1) {
                        placedElements[elementIndex].x = parseInt(selectedElement.style.left);
                        placedElements[elementIndex].y = parseInt(selectedElement.style.top);
                        
                        // ä¿å­˜è®¾è®¡
                        saveDesign();
                    }
                }
                
                isDragging = false;
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('mouseup', stopDrag);
            }
            
            // åœæ­¢è§¦æ‘¸å±æ‹–æ‹½
            function stopDragTouch() {
                if (isDragging && selectedElement) {
                    // æ›´æ–°å·²æ”¾ç½®å…ƒç´ çš„ä½ç½®
                    const elementId = selectedElement.id;
                    const elementIndex = placedElements.findIndex(el => el.id === elementId);
                    
                    if (elementIndex !== -1) {
                        placedElements[elementIndex].x = parseInt(selectedElement.style.left);
                        placedElements[elementIndex].y = parseInt(selectedElement.style.top);
                        
                        // ä¿å­˜è®¾è®¡
                        saveDesign();
                    }
                }
                
                isDragging = false;
                document.removeEventListener('touchmove', dragTouch);
                document.removeEventListener('touchend', stopDragTouch);
            }
        }
        
        // ä½¿å…ƒç´ å¯æ—‹è½¬
        function makeElementRotatable(element) {
            const rotateHandle = element.querySelector('.rotate-handle');
            
            rotateHandle.addEventListener('mousedown', startRotate);
            rotateHandle.addEventListener('touchstart', startRotateTouch);
            
            function startRotate(e) {
                e.preventDefault();
                e.stopPropagation();
                
                isRotating = true;
                selectedElement = element;
                
                // è·å–å…ƒç´ ä¸­å¿ƒç‚¹
                const rect = element.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                // è®¡ç®—åˆå§‹è§’åº¦
                const startAngle = Math.atan2(e.clientY - centerY, e.clientX - centerX);
                
                // è·å–å½“å‰æ—‹è½¬è§’åº¦
                const transform = element.style.transform || '';
                const match = transform.match(/rotate\(([-+]?[0-9]+\.?[0-9]*)deg\)/);
                const currentAngle = match ? parseFloat(match[1]) : 0;
                
                // æ·»åŠ å…¨å±€é¼ æ ‡ç§»åŠ¨å’Œæ¾å¼€äº‹ä»¶
                document.addEventListener('mousemove', rotate);
                document.addEventListener('mouseup', stopRotate);
                
                function rotate(e) {
                    if (!isRotating || !selectedElement) return;
                    
                    e.preventDefault();
                    
                    // è®¡ç®—æ–°è§’åº¦
                    const newAngle = Math.atan2(e.clientY - centerY, e.clientX - centerX);
                    const angleDiff = newAngle - startAngle;
                    const angleDeg = (angleDiff * 180 / Math.PI + currentAngle) % 360;
                    
                    // åº”ç”¨æ—‹è½¬
                    element.style.transform = `rotate(${angleDeg}deg)`;
                    
                    // æ›´æ–°å…ƒç´ ä¿¡æ¯
                    updateElementRotationInfo(element, angleDeg);
                }
                
                function stopRotate() {
                    if (isRotating && selectedElement) {
                        // æ›´æ–°å·²æ”¾ç½®å…ƒç´ çš„æ—‹è½¬è§’åº¦
                        const elementId = selectedElement.id;
                        const elementIndex = placedElements.findIndex(el => el.id === elementId);
                        
                        if (elementIndex !== -1) {
                            const transform = selectedElement.style.transform || '';
                            const match = transform.match(/rotate\(([-+]?[0-9]+\.?[0-9]*)deg\)/);
                            const rotation = match ? parseFloat(match[1]) : 0;
                            
                            placedElements[elementIndex].rotation = rotation;
                            
                            // ä¿å­˜è®¾è®¡
                            saveDesign();
                        }
                    }
                    
                    isRotating = false;
                    document.removeEventListener('mousemove', rotate);
                    document.removeEventListener('mouseup', stopRotate);
                }
            }
            
            function startRotateTouch(e) {
                e.preventDefault();
                e.stopPropagation();
                
                if (e.touches.length === 1) {
                    isRotating = true;
                    selectedElement = element;
                    
                    const touch = e.touches[0];
                    const rect = element.getBoundingClientRect();
                    const centerX = rect.left + rect.width / 2;
                    const centerY = rect.top + rect.height / 2;
                    
                    // è®¡ç®—åˆå§‹è§’åº¦
                    const startAngle = Math.atan2(touch.clientY - centerY, touch.clientX - centerX);
                    
                    // è·å–å½“å‰æ—‹è½¬è§’åº¦
                    const transform = element.style.transform || '';
                    const match = transform.match(/rotate\(([-+]?[0-9]+\.?[0-9]*)deg\)/);
                    const currentAngle = match ? parseFloat(match[1]) : 0;
                    
                    // æ·»åŠ å…¨å±€è§¦æ‘¸ç§»åŠ¨å’Œç»“æŸäº‹ä»¶
                    document.addEventListener('touchmove', rotateTouch);
                    document.addEventListener('touchend', stopRotateTouch);
                    
                    function rotateTouch(e) {
                        if (!isRotating || !selectedElement || e.touches.length !== 1) return;
                        
                        e.preventDefault();
                        
                        const touch = e.touches[0];
                        
                        // è®¡ç®—æ–°è§’åº¦
                        const newAngle = Math.atan2(touch.clientY - centerY, touch.clientX - centerX);
                        const angleDiff = newAngle - startAngle;
                        const angleDeg = (angleDiff * 180 / Math.PI + currentAngle) % 360;
                        
                        // åº”ç”¨æ—‹è½¬
                        element.style.transform = `rotate(${angleDeg}deg)`;
                        
                        // æ›´æ–°å…ƒç´ ä¿¡æ¯
                        updateElementRotationInfo(element, angleDeg);
                    }
                    
                    function stopRotateTouch() {
                        if (isRotating && selectedElement) {
                            // æ›´æ–°å·²æ”¾ç½®å…ƒç´ çš„æ—‹è½¬è§’åº¦
                            const elementId = selectedElement.id;
                            const elementIndex = placedElements.findIndex(el => el.id === elementId);
                            
                            if (elementIndex !== -1) {
                                const transform = selectedElement.style.transform || '';
                                const match = transform.match(/rotate\(([-+]?[0-9]+\.?[0-9]*)deg\)/);
                                const rotation = match ? parseFloat(match[1]) : 0;
                                
                                placedElements[elementIndex].rotation = rotation;
                                
                                // ä¿å­˜è®¾è®¡
                                saveDesign();
                            }
                        }
                        
                        isRotating = false;
                        document.removeEventListener('touchmove', rotateTouch);
                        document.removeEventListener('touchend', stopRotateTouch);
                    }
                }
            }
        }
        
        // é€‰æ‹©å…ƒç´ 
        function selectElement(element, data) {
            // ç§»é™¤å…¶ä»–å…ƒç´ çš„é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.draggable-element').forEach(el => {
                el.classList.remove('selected');
            });
            
            // æ·»åŠ é€‰ä¸­çŠ¶æ€
            element.classList.add('selected');
            selectedElement = element;
            
            // æ˜¾ç¤ºå…ƒç´ ä¿¡æ¯
            showElementInfo(element);
        }
        
        // æ˜¾ç¤ºå…ƒç´ ä¿¡æ¯
        function showElementInfo(element) {
            const infoPanel = document.getElementById('element-info');
            const infoTitle = document.getElementById('info-title');
            const infoCoords = document.getElementById('info-coords');
            const infoSize = document.getElementById('info-size');
            const infoRotation = document.getElementById('info-rotation');
            const coordX = document.getElementById('coord-x');
            const coordY = document.getElementById('coord-y');
            const rotationAngle = document.getElementById('rotation-angle');
            
            // è·å–å…ƒç´ æ•°æ®
            const elementId = element.id;
            const elementData = placedElements.find(el => el.id === elementId);
            
            if (elementData) {
                infoTitle.textContent = elementData.name;
                infoCoords.textContent = `åæ ‡: (${elementData.x}px, ${elementData.y}px)`;
                infoSize.textContent = `å°ºå¯¸: ${(elementData.width/50).toFixed(2)}m Ã— ${(elementData.height/50).toFixed(2)}m`;
                
                // è·å–æ—‹è½¬è§’åº¦
                const transform = element.style.transform || '';
                const match = transform.match(/rotate\(([-+]?[0-9]+\.?[0-9]*)deg\)/);
                const rotation = match ? parseFloat(match[1]) : 0;
                infoRotation.textContent = `æ—‹è½¬: ${rotation.toFixed(1)}Â°`;
                
                coordX.value = elementData.x;
                coordY.value = elementData.y;
                rotationAngle.value = rotation.toFixed(1);
                
                // å¡«å……å°ºå¯¸è¾“å…¥æ¡†ï¼ˆè½¬æ¢ä¸ºç±³ï¼‰
                const sizeWidth = document.getElementById('size-width');
                const sizeHeight = document.getElementById('size-height');
                if (sizeWidth && sizeHeight) {
                    sizeWidth.value = (elementData.width / 50).toFixed(2);
                    sizeHeight.value = (elementData.height / 50).toFixed(2);
                }
                
                infoPanel.classList.remove('hidden');
                
                // è‡ªåŠ¨èšç„¦åˆ°æ—‹è½¬è§’åº¦è¾“å…¥æ¡†ï¼Œæ–¹ä¾¿ç›´æ¥è¾“å…¥
                setTimeout(() => {
                    rotationAngle.focus();
                    rotationAngle.select(); // é€‰ä¸­ç°æœ‰æ–‡æœ¬ï¼Œæ–¹ä¾¿ç›´æ¥è¾“å…¥æ–°å€¼
                }, 100);
            }
        }
        
        // æ›´æ–°å…ƒç´ ä¿¡æ¯
        function updateElementInfo(element, x, y) {
            const infoCoords = document.getElementById('info-coords');
            const infoSize = document.getElementById('info-size');
            const coordX = document.getElementById('coord-x');
            const coordY = document.getElementById('coord-y');
            
            const elementData = placedElements.find(el => el.id === element.id);
            if (elementData) {
                infoCoords.textContent = `åæ ‡: (${Math.round(x)}px, ${Math.round(y)}px)`;
                infoSize.textContent = `å°ºå¯¸: ${(elementData.width/50).toFixed(2)}m Ã— ${(elementData.height/50).toFixed(2)}m`;
                coordX.value = Math.round(x);
                coordY.value = Math.round(y);
            }
        }
        
        // æ›´æ–°å…ƒç´ æ—‹è½¬ä¿¡æ¯
        function updateElementRotationInfo(element, rotation) {
            const infoRotation = document.getElementById('info-rotation');
            const rotationAngle = document.getElementById('rotation-angle');
            
            infoRotation.textContent = `æ—‹è½¬: ${rotation.toFixed(1)}Â°`;
            rotationAngle.value = rotation.toFixed(1);
        }
        
        // æ›´æ–°å…ƒç´ å°ºå¯¸
        function updateElementSize() {
            if (!selectedElement) return;
            
            const sizeWidth = document.getElementById('size-width');
            const sizeHeight = document.getElementById('size-height');
            
            let newWidthM = parseFloat(sizeWidth.value) || 0;
            let newHeightM = parseFloat(sizeHeight.value) || 0;
            
            // ç¡®ä¿å°ºå¯¸ä¸ºæ­£æ•°
            if (newWidthM <= 0 || newHeightM <= 0) {
                showNotification('å°ºå¯¸å¿…é¡»å¤§äº0', true);
                return;
            }
            
            // è½¬æ¢ä¸ºåƒç´ ï¼ˆ1ç±³ = 50pxï¼‰
            let newWidth = newWidthM * 50;
            let newHeight = newHeightM * 50;
            
            // ç¡®ä¿æœ€å°å°ºå¯¸ï¼ˆè‡³å°‘5pxï¼Œé¿å…å…ƒç´ å®Œå…¨ä¸å¯è§ï¼‰
            if (newWidth < 5) newWidth = 5;
            if (newHeight < 5) newHeight = 5;
            
            // è·å–å…ƒç´ ç±»å‹
            const elementId = selectedElement.id;
            const elementIndex = placedElements.findIndex(el => el.id === elementId);
            const elementType = elementIndex !== -1 ? placedElements[elementIndex].type : null;
            
            // æ›´æ–°å…ƒç´ å°ºå¯¸
            selectedElement.style.width = newWidth + 'px';
            selectedElement.style.height = newHeight + 'px';
            
            // ç¡®ä¿å…ƒç´ å¯è§
            selectedElement.style.display = 'flex';
            selectedElement.style.visibility = 'visible';
            
            // ç‰¹æ®Šå¤„ç†ï¼šæ ¹æ®å…ƒç´ ç±»å‹æ›´æ–°ç‰¹æ®Šæ ·å¼
            if (elementType === 'table-round') {
                // åœ†æ¡Œï¼šç¡®ä¿borderRadiusæ­£ç¡®ï¼ˆ50%ä¼šè‡ªåŠ¨é€‚åº”æ–°å°ºå¯¸ï¼‰
                selectedElement.style.borderRadius = '50%';
                selectedElement.style.border = '3px solid #5D4037';
                selectedElement.style.boxShadow = '0 0 8px rgba(0,0,0,0.3)';
                selectedElement.style.opacity = '0.7';
                selectedElement.style.backgroundColor = '#8D6E63';
            } else if (elementType === 'table-sector') {
                // ä¸‰è§’å½¢æ¡Œå­ï¼šç¡®ä¿clipPathæ­£ç¡®ï¼ˆç™¾åˆ†æ¯”ä¼šè‡ªåŠ¨é€‚åº”æ–°å°ºå¯¸ï¼‰
                selectedElement.style.clipPath = 'polygon(50% 0%, 0% 100%, 100% 100%)';
                selectedElement.style.borderRadius = '0';
                selectedElement.style.border = '2px solid #5D4037';
                selectedElement.style.opacity = '0.7';
                selectedElement.style.backgroundColor = '#795548';
            } else if (elementType === 'table-semi-round') {
                // åŠåœ†æ¡Œï¼šæ›´æ–°å†…éƒ¨å­å…ƒç´ çš„å°ºå¯¸ï¼ˆå…¬å…±å‡½æ•°ï¼‰
                updateSemiRoundTable(selectedElement, newWidth, newHeight);
            } else if (elementType === 'door-double' || elementType === 'door-single') {
                // é—¨ï¼šç¡®ä¿è¾¹æ¡†æ ·å¼æ­£ç¡®
                selectedElement.style.border = '2px solid #5D4037';
            }
            
            // æ›´æ–°å·²æ”¾ç½®å…ƒç´ çš„å°ºå¯¸
            if (elementIndex !== -1) {
                // æ£€æŸ¥å¹¶è°ƒæ•´ä½ç½®ï¼Œç¡®ä¿å…ƒç´ ä¸ä¼šè¶…å‡ºç”»å¸ƒèŒƒå›´
                const currentX = parseInt(selectedElement.style.left) || 0;
                const currentY = parseInt(selectedElement.style.top) || 0;
                const maxX = classroomConfig.width - newWidth;
                const maxY = classroomConfig.height + 150 - newHeight; // åŒ…æ‹¬ä¸‹æ–¹åŒºåŸŸ
                
                let adjustedX = Math.max(0, Math.min(currentX, maxX));
                let adjustedY = Math.max(0, Math.min(currentY, maxY));
                
                // å¦‚æœä½ç½®éœ€è¦è°ƒæ•´ï¼Œæ›´æ–°ä½ç½®
                if (adjustedX !== currentX || adjustedY !== currentY) {
                    selectedElement.style.left = adjustedX + 'px';
                    selectedElement.style.top = adjustedY + 'px';
                    placedElements[elementIndex].x = adjustedX;
                    placedElements[elementIndex].y = adjustedY;
                }
                
                placedElements[elementIndex].width = newWidth;
                placedElements[elementIndex].height = newHeight;
                
                // æ›´æ–°z-indexï¼ˆå› ä¸ºå°ºå¯¸æ”¹å˜äº†ï¼‰
                // ç‰¹æ®Šå…ƒç´ ï¼ˆåœ†æ¡Œã€æ‰‡å½¢æ¡Œï¼‰ä¿æŒé«˜ä¼˜å…ˆçº§z-index
                if (elementType === 'table-round' || elementType === 'table-sector') {
                    placedElements[elementIndex].zIndex = 1000;
                    selectedElement.style.zIndex = '1000';
                } else {
                    placedElements[elementIndex].zIndex = calculateZIndex(newWidth, newHeight);
                    selectedElement.style.zIndex = placedElements[elementIndex].zIndex;
                }
                
                // ä¿å­˜è®¾è®¡
                saveDesign();
                
                // æ›´æ–°æ˜¾ç¤º
                const infoSize = document.getElementById('info-size');
                infoSize.textContent = `å°ºå¯¸: ${newWidthM.toFixed(2)}m Ã— ${newHeightM.toFixed(2)}m`;
                
                // æ›´æ–°åæ ‡æ˜¾ç¤º
                updateElementInfo(selectedElement, adjustedX, adjustedY);
                
                // æ˜¾ç¤ºé€šçŸ¥
                showNotification(`å°ºå¯¸å·²æ›´æ–°ä¸º ${newWidthM.toFixed(2)}m Ã— ${newHeightM.toFixed(2)}m`);
            }
        }
        
        // æ›´æ–°å…ƒç´ åæ ‡
        function updateElementCoords() {
            if (!selectedElement) return;
            
            const coordX = document.getElementById('coord-x');
            const coordY = document.getElementById('coord-y');
            
            const newX = parseInt(coordX.value) || 0;
            const newY = parseInt(coordY.value) || 0;
            
            // æ›´æ–°å…ƒç´ ä½ç½®
            selectedElement.style.left = newX + 'px';
            selectedElement.style.top = newY + 'px';
            
            // æ›´æ–°å·²æ”¾ç½®å…ƒç´ çš„ä½ç½®
            const elementId = selectedElement.id;
            const elementIndex = placedElements.findIndex(el => el.id === elementId);
            
            if (elementIndex !== -1) {
                placedElements[elementIndex].x = newX;
                placedElements[elementIndex].y = newY;
                
                // ä¿å­˜è®¾è®¡
                saveDesign();
                
                // æ›´æ–°æ˜¾ç¤º
                updateElementInfo(selectedElement, newX, newY);
            }
        }
        
        // æ›´æ–°å…ƒç´ æ—‹è½¬
        function updateElementRotation() {
            if (!selectedElement) return;
            
            const rotationAngle = document.getElementById('rotation-angle');
            let newRotation = parseFloat(rotationAngle.value) || 0;
            
            // ç¡®ä¿è§’åº¦åœ¨0-360åº¦èŒƒå›´å†…
            newRotation = newRotation % 360;
            if (newRotation < 0) newRotation += 360;
            
            // åº”ç”¨æ—‹è½¬
            selectedElement.style.transform = `rotate(${newRotation}deg)`;
            
            // æ›´æ–°å·²æ”¾ç½®å…ƒç´ çš„æ—‹è½¬è§’åº¦
            const elementId = selectedElement.id;
            const elementIndex = placedElements.findIndex(el => el.id === elementId);
            
            if (elementIndex !== -1) {
                placedElements[elementIndex].rotation = newRotation;
                
                // ä¿å­˜è®¾è®¡
                saveDesign();
                
                // æ›´æ–°æ˜¾ç¤º
                updateElementRotationInfo(selectedElement, newRotation);
                
                // æ˜¾ç¤ºé€šçŸ¥
                showNotification(`æ—‹è½¬è§’åº¦å·²æ›´æ–°ä¸º ${newRotation.toFixed(1)}Â°`);
            }
        }
        
        // åˆ é™¤é€‰ä¸­å…ƒç´ 
        function deleteSelectedElement() {
            if (!selectedElement) return;
            
            const elementId = selectedElement.id;
            deleteElement(elementId);
        }
        
        // åˆ é™¤å…ƒç´ 
        function deleteElement(elementId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå…ƒç´ å—ï¼Ÿ')) {
                return;
            }
            
            // ä»DOMä¸­ç§»é™¤å…ƒç´ 
            const element = document.getElementById(elementId);
            if (element) {
                element.remove();
            }
            
            // ä»å·²æ”¾ç½®å…ƒç´ æ•°ç»„ä¸­ç§»é™¤
            const elementIndex = placedElements.findIndex(el => el.id === elementId);
            if (elementIndex !== -1) {
                placedElements.splice(elementIndex, 1);
            }
            
            // éšè—å…ƒç´ ä¿¡æ¯é¢æ¿
            const infoPanel = document.getElementById('element-info');
            infoPanel.classList.add('hidden');
            
            // æ¸…é™¤é€‰ä¸­çŠ¶æ€
            selectedElement = null;
            
            // ä¿å­˜è®¾è®¡
            saveDesign();
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStatistics();
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification('å…ƒç´ å·²åˆ é™¤');
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStatistics() {
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = '';
            
            draggableElements.forEach(element => {
                const count = placedElements.filter(el => el.type === element.id).length;
                const statItem = document.createElement('div');
                statItem.className = 'stat-item';
                
                const statName = document.createElement('div');
                statName.className = 'stat-name';
                statName.textContent = element.name;
                
                const statValue = document.createElement('div');
                statValue.className = 'stat-value';
                statValue.textContent = `${count}/${element.maxCount}`;
                
                // å¦‚æœè¾¾åˆ°ä¸Šé™ï¼Œæ ‡è®°ä¸ºçº¢è‰²
                if (count >= element.maxCount) {
                    statValue.style.color = '#e74c3c';
                }
                
                statItem.appendChild(statName);
                statItem.appendChild(statValue);
                statsGrid.appendChild(statItem);
            });
        }
        
        // ä¿å­˜è®¾è®¡åˆ°æœ¬åœ°å­˜å‚¨
        function saveDesign() {
            const design = {
                elements: placedElements,
                savedAt: new Date().toISOString()
            };
            
            localStorage.setItem('classroomDesign', JSON.stringify(design));
            showNotification('è®¾è®¡å·²ä¿å­˜');
        }
        
        // åŠ è½½ä¿å­˜çš„è®¾è®¡
        function loadSavedDesign() {
            const savedDesign = localStorage.getItem('classroomDesign');
            
            if (savedDesign) {
                try {
                    const design = JSON.parse(savedDesign);
                    placedElements = design.elements || [];
                    
                    // é‡æ–°åˆ›å»ºå·²æ”¾ç½®çš„å…ƒç´ 
                    const draggableContainer = document.getElementById('draggable-container');
                    draggableContainer.innerHTML = '';
                    
                    placedElements.forEach(elementData => {
                        const data = draggableElements.find(el => el.id === elementData.type);
                        if (data) {
                            // ä½¿ç”¨ä¿å­˜çš„å°ºå¯¸åˆ›å»ºå…ƒç´ ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤å°ºå¯¸
                            const elementWidth = elementData.width || data.width;
                            const elementHeight = elementData.height || data.height;
                            
                            // ä¸´æ—¶ä¿®æ”¹dataçš„å°ºå¯¸ï¼Œä»¥ä¾¿createDraggableElementä½¿ç”¨æ­£ç¡®çš„å°ºå¯¸
                            const originalWidth = data.width;
                            const originalHeight = data.height;
                            data.width = elementWidth;
                            data.height = elementHeight;
                            
                            const elementId = createDraggableElement(data, elementData.x, elementData.y);
                            
                            // æ¢å¤åŸå§‹æ•°æ®
                            data.width = originalWidth;
                            data.height = originalHeight;
                            
                            // åº”ç”¨ä¿å­˜çš„æ—‹è½¬è§’åº¦
                            const element = document.getElementById(elementId);
                            if (element) {
                                if (elementData.rotation) {
                                    element.style.transform = `rotate(${elementData.rotation}deg)`;
                                }
                                
                                // åº”ç”¨ä¿å­˜çš„å°ºå¯¸ï¼ˆç¡®ä¿å°ºå¯¸æ­£ç¡®ï¼‰
                                element.style.width = elementWidth + 'px';
                                element.style.height = elementHeight + 'px';
                                
                                // ç¡®ä¿å…ƒç´ å¯è§
                                element.style.display = 'flex';
                                element.style.visibility = 'visible';
                                
                                // ç‰¹æ®Šå¤„ç†ï¼šæ ¹æ®å…ƒç´ ç±»å‹åº”ç”¨ç‰¹æ®Šæ ·å¼
                                if (elementData.type === 'table-round') {
                                    // åœ†æ¡Œï¼šç¡®ä¿borderRadiusæ­£ç¡®
                                    element.style.borderRadius = '50%';
                                    element.style.border = '3px solid #5D4037';
                                    element.style.boxShadow = '0 0 8px rgba(0,0,0,0.3)';
                                    element.style.opacity = '0.7';
                                    element.style.backgroundColor = '#8D6E63';
                                    element.style.zIndex = '1000';
                                } else if (elementData.type === 'table-sector') {
                                    // ä¸‰è§’å½¢æ¡Œå­ï¼šç¡®ä¿clipPathæ­£ç¡®
                                    element.style.clipPath = 'polygon(50% 0%, 0% 100%, 100% 100%)';
                                    element.style.borderRadius = '0';
                                    element.style.border = '2px solid #5D4037';
                                    element.style.opacity = '0.7';
                                    element.style.backgroundColor = '#795548';
                                    element.style.zIndex = '1000';
                                } else if (elementData.type === 'table-semi-round') {
                                    // åŠåœ†æ¡Œï¼šæ›´æ–°å†…éƒ¨å­å…ƒç´ çš„å°ºå¯¸ï¼ˆå…¬å…±å‡½æ•°ï¼‰
                                    updateSemiRoundTable(element, elementWidth, elementHeight);
                                    if (elementData.zIndex) {
                                        element.style.zIndex = elementData.zIndex;
                                    }
                                } else if (elementData.type === 'door-double' || elementData.type === 'door-single') {
                                    // é—¨ï¼šç¡®ä¿è¾¹æ¡†æ ·å¼æ­£ç¡®
                                    element.style.border = '2px solid #5D4037';
                                    if (elementData.zIndex) {
                                        element.style.zIndex = elementData.zIndex;
                                    }
                                } else {
                                    // å…¶ä»–å…ƒç´ ï¼šåº”ç”¨ä¿å­˜çš„z-index
                                    if (elementData.zIndex) {
                                        element.style.zIndex = elementData.zIndex;
                                    }
                                }
                            }
                        }
                    });
                    
                    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                    updateStatistics();
                    
                    console.log('è®¾è®¡å·²åŠ è½½');
                } catch (error) {
                    console.error('åŠ è½½è®¾è®¡å¤±è´¥:', error);
                }
            }
        }
        
        // é‡ç½®è®¾è®¡
        function resetDesign() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰å…ƒç´ å—ï¼Ÿè¿™å°†æ¸…é™¤æ‰€æœ‰å·²æ·»åŠ çš„å…ƒç´ ã€‚')) {
                placedElements = [];
                selectedElement = null;
                
                const draggableContainer = document.getElementById('draggable-container');
                draggableContainer.innerHTML = '';
                
                const infoPanel = document.getElementById('element-info');
                infoPanel.classList.add('hidden');
                
                localStorage.removeItem('classroomDesign');
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                updateStatistics();
                
                showNotification('è®¾è®¡å·²é‡ç½®');
            }
        }
        
        // å¯¼å‡ºè®¾è®¡é…ç½®
        function exportDesign() {
            const design = {
                classroom: {
                    width: classroomConfig.width,
                    height: classroomConfig.height,
                    unit: 'px',
                    scale: '1px = 2cm (å®é™…1m = 50px)'
                },
                fixedShapes: fixedShapes.map(shape => ({
                    name: shape.name,
                    x: shape.x,
                    y: shape.y,
                    width: shape.width,
                    height: shape.height,
                    color: shape.color,
                    desc: shape.desc
                })),
                placedElements: placedElements.map(el => ({
                    ...el,
                    // è®¡ç®—å®é™…ç±³æ•°
                    widthM: (el.width / 50).toFixed(2),
                    heightM: (el.height / 50).toFixed(2)
                })),
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(design, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'æ•™å®¤è®¾è®¡-' + new Date().toISOString().split('T')[0] + '.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('è®¾è®¡é…ç½®å·²å¯¼å‡ºä¸ºJSONæ–‡ä»¶');
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, isError = false) {
            // åˆ›å»ºé€šçŸ¥å…ƒç´ 
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${isError ? '#e74c3c' : '#2ecc71'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 1000;
                font-weight: 500;
                animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s;
                animation-fill-mode: forwards;
            `;
            
            notification.textContent = message;
            
            // æ·»åŠ CSSåŠ¨ç”»
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes fadeOut {
                    from { opacity: 1; }
                    to { opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            // 3ç§’åç§»é™¤é€šçŸ¥
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }
        
        // é¢œè‰²å˜æš—å‡½æ•°
        function darkenColor(color, percent) {
            // å¦‚æœæ˜¯åå…­è¿›åˆ¶é¢œè‰²
            if (color.startsWith('#')) {
                let r = parseInt(color.substr(1, 2), 16);
                let g = parseInt(color.substr(3, 2), 16);
                let b = parseInt(color.substr(5, 2), 16);
                
                r = Math.floor(r * (100 - percent) / 100);
                g = Math.floor(g * (100 - percent) / 100);
                b = Math.floor(b * (100 - percent) / 100);
                
                return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
            }
            
            return color;
        }

        // åŠåœ†æ¡Œå†…éƒ¨ç»“æ„æ›´æ–°ï¼ˆæŠ½å–å…¬å…±é€»è¾‘ï¼Œé¿å…é‡å¤ä»£ç ï¼‰
        function updateSemiRoundTable(element, width, height) {
            if (!element) return;
            const container = element.querySelector('.semi-table-container');
            if (!container) return;

            // çŸ©å½¢éƒ¨åˆ†ï¼šå®½åº¦=å¤–å±‚å®½åº¦ï¼Œé«˜åº¦=å¤–å±‚é«˜åº¦çš„ä¸€åŠ
            const rectangle = container.querySelector('.semi-table-rectangle');
            if (rectangle) {
                rectangle.style.width = width + 'px';
                rectangle.style.height = (height / 2) + 'px';
            }

            // åŠåœ†å½¢éƒ¨åˆ†ï¼šå®½åº¦=å¤–å±‚å®½åº¦ï¼Œé«˜åº¦=å¤–å±‚é«˜åº¦çš„ä¸€åŠ
            const semicircle = container.querySelector('.semi-table-semicircle');
            if (semicircle) {
                semicircle.style.width = width + 'px';
                semicircle.style.height = (height / 2) + 'px';
                semicircle.style.borderRadius = `0 0 ${width}px ${width}px`;
                semicircle.style.top = (height / 2) + 'px';
            }

            // è™šçº¿ä½ç½®ï¼šåœ¨å¤–å±‚é«˜åº¦çš„ä¸€åŠå¤„
            const dashedLine = container.querySelector('.semi-table-dashed-line');
            if (dashedLine) {
                dashedLine.style.top = (height / 2) + 'px';
            }

            // ç¡®ä¿åŠåœ†æ¡Œå®¹å™¨æœ¬èº«é€æ˜ã€ä¸å¸¦è¾¹æ¡†
            element.style.backgroundColor = 'transparent';
            element.style.border = 'none';
        }
        
        // ç‚¹å‡»ç”»å¸ƒå…¶ä»–åŒºåŸŸå–æ¶ˆé€‰æ‹©
        document.getElementById('canvasInner').addEventListener('click', (e) => {
            // å¦‚æœç‚¹å‡»çš„ä¸æ˜¯å¯æ‹–æ‹½å…ƒç´ 
            if (!e.target.closest('.draggable-element') && !e.target.closest('.fixed-shape')) {
                // ç§»é™¤æ‰€æœ‰å…ƒç´ çš„é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.draggable-element').forEach(el => {
                    el.classList.remove('selected');
                });
                
                // éšè—å…ƒç´ ä¿¡æ¯é¢æ¿
                const infoPanel = document.getElementById('element-info');
                infoPanel.classList.add('hidden');
                
                selectedElement = null;
            }
        });
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
